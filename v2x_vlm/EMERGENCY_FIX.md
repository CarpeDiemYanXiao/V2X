# ç´§æ€¥ä¿®å¤ï¼šæ•°æ®å¼‚å¸¸å€¼å¯¼è‡´è®­ç»ƒå´©æºƒ

## ğŸ”´ é—®é¢˜æ ¹æº

ä½ çš„æ•°æ®ä¸­æœ‰**ä¸¥é‡çš„å¼‚å¸¸å€¼**ï¼š

```
åæ ‡èŒƒå›´: [-2961.65, 3047.06] ç±³  â† è¿™æ˜¯3å…¬é‡Œï¼
æœ€å¤§è·ç¦»: 3284.52 ç±³  â† 4.5ç§’åè·‘äº†3å…¬é‡Œï¼Ÿä¸å¯èƒ½ï¼
è®­ç»ƒæŸå¤±: 26549180  â† 2600ä¸‡ï¼Œå®Œå…¨çˆ†ç‚¸
```

**æ­£å¸¸æƒ…å†µåº”è¯¥æ˜¯**ï¼š
- 4.5ç§’å†…ï¼Œè½¦è¾†æœ€å¤šè¡Œé©¶ 150ç±³ï¼ˆ120km/h = 33m/sï¼‰
- åæ ‡èŒƒå›´åº”è¯¥åœ¨ [-200, 200] ç±³ä»¥å†…
- è®­ç»ƒæŸå¤±åº”è¯¥åœ¨ 10-100 ä¹‹é—´

## âœ… å·²åº”ç”¨çš„ç´§æ€¥ä¿®å¤

### ä¿®å¤1: æ•°æ®é¢„å¤„ç† - è¿‡æ»¤å¼‚å¸¸å€¼
**æ–‡ä»¶**: `src/data/dataset.py`

```python
# æ–°å¢ï¼šæ£€æŸ¥å¹¶è¿‡æ»¤å¼‚å¸¸è½¨è¿¹
max_reasonable_distance = 200.0  # 4.5ç§’å†…æœ€å¤š200ç±³

distances = torch.norm(traj_rotated, dim=-1)
max_distance = distances.max().item()

if max_distance > max_reasonable_distance:
    # ç¼©æ”¾åˆ°åˆç†èŒƒå›´
    scale_factor = max_reasonable_distance / max_distance
    traj_rotated = traj_rotated * scale_factor

# ç¡¬æˆªæ–­åˆ°[-300, 300]
traj_rotated = torch.clamp(traj_rotated, min=-300.0, max=300.0)
```

### ä¿®å¤2: ä½¿ç”¨Huber Loss
**æ–‡ä»¶**: `scripts/train_teacher_regression.py`

```python
# ä»MSE Lossæ”¹ä¸ºHuber Lossï¼ˆå¯¹å¼‚å¸¸å€¼æ›´é²æ£’ï¼‰
loss = nn.functional.huber_loss(pred_coords, gt_traj_coords, 
                                reduction='mean', delta=10.0)
```

**Huber Lossçš„ä¼˜åŠ¿**ï¼š
- è¯¯å·®å°æ—¶ï¼ˆ<10ç±³ï¼‰ï¼šä½¿ç”¨L2ï¼Œæ¢¯åº¦å¹³æ»‘
- è¯¯å·®å¤§æ—¶ï¼ˆ>10ç±³ï¼‰ï¼šä½¿ç”¨L1ï¼Œæ¢¯åº¦ä¸ä¼šçˆ†ç‚¸

### ä¿®å¤3: é™ä½å­¦ä¹ ç‡
**æ–‡ä»¶**: `scripts/train_teacher_regression.py`

```python
# ä»1e-2é™å›5e-3ï¼Œé¿å…æ¢¯åº¦çˆ†ç‚¸
lr=5e-3
```

### ä¿®å¤4: ä¿å®ˆçš„ç½‘ç»œåˆå§‹åŒ–
**æ–‡ä»¶**: `src/models/v2x_vlm_teacher_regression.py`

```python
# ä»std=1.0é™åˆ°std=0.01ï¼Œè®©åˆå§‹è¾“å‡ºæ›´å°
nn.init.normal_(module.weight, mean=0.0, std=0.01)
```

## ğŸš€ ç°åœ¨é‡æ–°è®­ç»ƒ

```bash
python scripts/train_teacher_regression.py
```

## ğŸ“Š é¢„æœŸç»“æœ

### ç¬¬ä¸€ä¸ªepochåº”è¯¥çœ‹åˆ°ï¼š

**å¥½çš„è¿¹è±¡** âœ…ï¼š
```
[Debug T=4.5s] GT: [192.0, -165.5] | Pred: [-15.2, -8.3] | Error: 210.50m
[Range] GT: [-165.5, 192.0] | Pred: [-50.5, 45.2] | Loss: 85.23  â† æ­£å¸¸èŒƒå›´
Train Loss: 95.2341 | LR: 5.00e-03  â† æ­£å¸¸èŒƒå›´
Val L2 Error: 65.2341 meters  â† æ¯”åˆå§‹çš„68ç±³ç•¥æœ‰æ”¹å–„
```

**å…³é”®æŒ‡æ ‡**ï¼š
- âœ… Lossåœ¨ 50-150 ä¹‹é—´ï¼ˆä¸æ˜¯2600ä¸‡ï¼‰
- âœ… é¢„æµ‹èŒƒå›´åœ¨ [-100, 100] å·¦å³
- âœ… æ¯ä¸ªepochåLossæŒç»­ä¸‹é™

### è®­ç»ƒè¶‹åŠ¿ï¼ˆé¢„æœŸï¼‰ï¼š

```
Epoch 1: Loss 95.23, Val L2: 65.23m
Epoch 2: Loss 78.45, Val L2: 58.67m  â† æŒç»­ä¸‹é™
Epoch 3: Loss 65.12, Val L2: 52.34m
Epoch 5: Loss 48.90, Val L2: 45.12m
Epoch 10: Loss 35.67, Val L2: 38.50m  â† æœ€ç»ˆç›®æ ‡
```

## âš ï¸ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

### æ£€æŸ¥1: æ•°æ®æ˜¯å¦çœŸçš„è¢«è¿‡æ»¤äº†

è¿è¡Œè¿™ä¸ªè„šæœ¬æ£€æŸ¥ï¼š
```bash
python scripts/check_data_stats.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```
æœ€å¤§å€¼: 300.00 ç±³  â† è¢«æˆªæ–­äº†
æœ€å¤§è·ç¦»: 200.00 ç±³  â† è¢«ç¼©æ”¾äº†
```

### æ£€æŸ¥2: æ˜¯å¦è¿˜æœ‰å…¶ä»–å¼‚å¸¸

å¦‚æœç¬¬ä¸€ä¸ªepochçš„Lossè¿˜æ˜¯å¾ˆå¤§ï¼ˆ>500ï¼‰ï¼Œè¯´æ˜è¿˜æœ‰é—®é¢˜ã€‚

å¯ä»¥å°è¯•æ›´æ¿€è¿›çš„æˆªæ–­ï¼š
```python
# åœ¨ dataset.py ä¸­ä¿®æ”¹
max_reasonable_distance = 150.0  # ä»200é™åˆ°150
traj_rotated = torch.clamp(traj_rotated, min=-150.0, max=150.0)  # ä»300é™åˆ°150
```

### æ£€æŸ¥3: è€ƒè™‘æ•°æ®å½’ä¸€åŒ–

å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸è¡Œï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–ï¼š

åœ¨ `dataset.py` çš„æœ€åæ·»åŠ ï¼š
```python
# å½’ä¸€åŒ–åˆ°[-1, 1]èŒƒå›´
traj_rotated = traj_rotated / 150.0
```

ç„¶ååœ¨è®­ç»ƒè„šæœ¬ä¸­åå½’ä¸€åŒ–ï¼š
```python
pred_coords = pred_coords * 150.0  # é¢„æµ‹åä¹˜å›æ¥
gt_traj_coords = gt_traj_coords * 150.0  # GTä¹Ÿè¦ä¹˜å›æ¥
```

## ğŸ“ æ€»ç»“

**æ ¹æœ¬é—®é¢˜**ï¼šæ•°æ®ä¸­æœ‰3å…¬é‡Œçš„å¼‚å¸¸è½¨è¿¹ï¼Œå¯¼è‡´MSE Lossçˆ†ç‚¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. âœ… æ•°æ®é¢„å¤„ç†ï¼šæˆªæ–­åˆ°200ç±³ä»¥å†…
2. âœ… ä½¿ç”¨Huber Lossï¼šå¯¹å¼‚å¸¸å€¼é²æ£’
3. âœ… é™ä½å­¦ä¹ ç‡ï¼šé¿å…æ¢¯åº¦çˆ†ç‚¸
4. âœ… ä¿å®ˆåˆå§‹åŒ–ï¼šè®©åˆå§‹è¾“å‡ºæ›´å°

**ç°åœ¨å¯ä»¥é‡æ–°è®­ç»ƒäº†ï¼** ğŸš€

å¦‚æœç¬¬ä¸€ä¸ªepochçš„Lossåœ¨50-150ä¹‹é—´ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼
